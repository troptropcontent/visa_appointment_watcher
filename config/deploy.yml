# Name of your application. Used to uniquely configure containers.
service: visa_appointment_watcher

# Name of the container image.
image: troptropcontent/visa_appointment_watcher
builder:
  remote:
    arch: amd64
    host: ssh://ubuntu@51.68.196.119
volumes:
  - storage:/storage
  - logs:/logs
servers:
  web:
    hosts:
      - 51.68.196.119
    labels:
      traefik.http.routers.visa_appointment_watcher.entrypoints: websecure
      traefik.http.routers.visa_appointment_watcher.rule: Host(`visa-appointment-watcher.thepocman.com`)
      traefik.http.routers.visa_appointment_watcher.tls: "true"
      traefik.http.routers.visa_appointment_watcher.tls.certresolver: letsencrypt
registry:
  username: troptropcontent
  password:
    - KAMAL_REGISTRY_PASSWORD
ssh:
  user: ubuntu
traefik:
  options:
    publish:
      - "443:443"
    volume:
      - "/letsencrypt/acme.json:/letsencrypt/acme.json"
  args:
    log.level: "DEBUG"
    entryPoints.web.address: ":80"
    entryPoints.websecure.address: ":443"
    certificatesResolvers.letsencrypt.acme.email: "tomecrepont@gmail.com"
    certificatesResolvers.letsencrypt.acme.storage: "/letsencrypt/acme.json"
    certificatesResolvers.letsencrypt.acme.httpchallenge: true
    certificatesResolvers.letsencrypt.acme.httpchallenge.entrypoint: web
